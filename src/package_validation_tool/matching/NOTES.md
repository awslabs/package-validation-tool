This file contains misc notes when working on file-matching with additional
validators, e.g., Autotools.

## Autotools

Autotools is officially comprised of two packages:
- autoconf (contains two important tools: autoconf and autoheader)
- automake (contains two important tools: automake and aclocal)

However, there are also these two packages that are officially not a part of
Autotools, but in reality required in many Autotools flows:
- gettext (contains an important tool: autopoint, previously called gettext)
- libtool (contains an important tool: libtoolize)

For the purposes of these notes, we consider all four packages as "Autotools".

### Autotools order

It is very important to call programs from Autotools in a particular order.
Internet has a lot of incorrect/misleading/non-complete instructions and
diagrams. We found the "Autotools tutorial" by Alexandre Duret-Lutz to be
complete and correct: https://www.lrde.epita.fr/~adl/autotools.html

See the order in autotools.py.

Do NOT try to modify the order of Autotools invocations! Otherwise you will
encounter hard-to-decipher errors.

### Autoconf 2.69 and the `runstatedir` backported patch

Autoconf produces the `configure` script. We aim for all files -- including
this script -- to be 100% matching. For this reason, we download and
locally-install an appropriate version of Autoconf.

Unfortunately, there was a significant change in Autoconf between versions 2.69
and 2.70. Version 2.70 added the `runstatedir` feature. This feature was
subsequently backported to 2.69 by many OS distros (including Fedora, Debian,
Amazon Linux). At the same time, vanilla Autoconf 2.69 is also used by some OS
distros (or even by individual package maintainers).

This implies that the `configure` script in the SRPM source archives could be
built by two indistinguishable versions of Autoconf:
- patched autoconf 2.69,
- vanilla autoconf 2.69.

Current implementation in autotools.py opts to use the patched version (because
the authors target the common case of archives built by Fedora maintainers). We
cherry-picked that particular patch under configuration/external_patches/.

This trick with patching v2.69 works well for many Fedora/Amazon Linux packages
(e.g., for openssh). However, it breaks for xz, because the xz archive is built
by upstream xz maintainers (who use the vanilla v2.69) and then simply consumed
by Fedora. As a result, currently our matching algorithm reports xz's
`configure` file as different in git repo and in SRPM archive.

### Gettext versions

There is no explicit signature like "generated by gettext version x.y.z" in any
of the files produced (copied) by autopoint, which is a tool from the Gettext
package. Therefore, we must fall back to an ad-hoc way of determining the
gettext version.

TODO: Determine the gettext version. Take into account that gettext may require
backports, similarly to autoconf above.
